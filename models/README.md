# Model Layer Documentation

## ğŸ“‹ Overview

Model Layer à¸„à¸·à¸­ **Data Access Layer** à¸—à¸µà¹ˆà¸ˆà¸±à¸”à¸à¸²à¸£à¸—à¸¸à¸à¸­à¸¢à¹ˆà¸²à¸‡à¹€à¸à¸µà¹ˆà¸¢à¸§à¸à¸±à¸šà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹à¸¥à¸°à¸à¸²à¸™à¸‚à¹‰à¸­à¸¡à¸¹à¸¥ à¸•à¸²à¸¡à¸«à¸¥à¸±à¸à¸à¸²à¸£ MVC Pattern à¸—à¸µà¹ˆà¸–à¸¹à¸à¸•à¹‰à¸­à¸‡

## ğŸ¯ à¸«à¸™à¹‰à¸²à¸—à¸µà¹ˆà¸‚à¸­à¸‡ Model Layer

### âœ… Model à¸„à¸§à¸£à¸—à¸³:
1. **CRUD Operations** - à¸ªà¸£à¹‰à¸²à¸‡, à¸­à¹ˆà¸²à¸™, à¸­à¸±à¸›à¹€à¸”à¸•, à¸¥à¸šà¸‚à¹‰à¸­à¸¡à¸¹à¸¥
2. **Data Validation** - à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸„à¸§à¸²à¸¡à¸–à¸¹à¸à¸•à¹‰à¸­à¸‡à¸‚à¸­à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥
3. **Business Logic** - à¸à¸à¸—à¸²à¸‡à¸˜à¸¸à¸£à¸à¸´à¸ˆà¸—à¸µà¹ˆà¹€à¸à¸µà¹ˆà¸¢à¸§à¸‚à¹‰à¸­à¸‡à¸à¸±à¸šà¸‚à¹‰à¸­à¸¡à¸¹à¸¥
4. **Data Integrity** - à¸£à¸±à¸à¸©à¸²à¸„à¸§à¸²à¸¡à¸ªà¸¡à¸šà¸¹à¸£à¸“à¹Œà¸‚à¸­à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥
5. **Database Queries** - SQL queries, JOINs, transactions
6. **Domain Rules** - à¸à¸à¹€à¸‰à¸à¸²à¸°à¸‚à¸­à¸‡à¹‚à¸”à¹€à¸¡à¸™ (à¹€à¸Šà¹ˆà¸™ à¸«à¹‰à¸²à¸¡à¸‹à¹‰à¸³, à¸„à¸§à¸²à¸¡à¸ªà¸±à¸¡à¸à¸±à¸™à¸˜à¹Œà¸‚à¸­à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥)

### âŒ Model à¹„à¸¡à¹ˆà¸„à¸§à¸£à¸—à¸³:
1. âŒ à¸ˆà¸±à¸”à¸à¸²à¸£ HTTP request/response
2. âŒ à¸£à¸¹à¹‰à¸ˆà¸±à¸ status code (200, 404, 500)
3. âŒ à¸ˆà¸±à¸”à¸à¸²à¸£ session
4. âŒ Render views
5. âŒ à¸ˆà¸±à¸”à¸à¸²à¸£ routing
6. âŒ Authentication/Authorization logic

## ğŸ“ à¹‚à¸„à¸£à¸‡à¸ªà¸£à¹‰à¸²à¸‡ Models

```
models/
â”œâ”€â”€ index.js                    # Central export
â”œâ”€â”€ Patient.model.js            # à¸œà¸¹à¹‰à¸›à¹ˆà¸§à¸¢
â”œâ”€â”€ Dentist.model.js            # à¸—à¸±à¸™à¸•à¹à¸à¸—à¸¢à¹Œ
â”œâ”€â”€ User.model.js               # à¸œà¸¹à¹‰à¹ƒà¸Šà¹‰à¸£à¸°à¸šà¸š
â”œâ”€â”€ Queue.model.js              # à¸„à¸´à¸§à¸™à¸±à¸”à¸«à¸¡à¸²à¸¢
â”œâ”€â”€ Treatment.model.js          # à¸›à¸£à¸°à¹€à¸ à¸—à¸à¸²à¸£à¸£à¸±à¸à¸©à¸²
â””â”€â”€ TreatmentHistory.model.js  # à¸›à¸£à¸°à¸§à¸±à¸•à¸´à¸à¸²à¸£à¸£à¸±à¸à¸©à¸²
```

## ğŸ“– Model APIs

### 1. Patient.model.js

à¸ˆà¸±à¸”à¸à¸²à¸£à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸œà¸¹à¹‰à¸›à¹ˆà¸§à¸¢

**Methods:**
- `create(patientData)` - à¸ªà¸£à¹‰à¸²à¸‡à¸œà¸¹à¹‰à¸›à¹ˆà¸§à¸¢à¹ƒà¸«à¸¡à¹ˆ
- `findById(patientId)` - à¸„à¹‰à¸™à¸«à¸²à¸”à¹‰à¸§à¸¢ ID
- `findByUserId(userId)` - à¸„à¹‰à¸™à¸«à¸²à¸”à¹‰à¸§à¸¢ user_id
- `findByIdCard(idCard)` - à¸„à¹‰à¸™à¸«à¸²à¸”à¹‰à¸§à¸¢à¹€à¸¥à¸‚à¸šà¸±à¸•à¸£à¸›à¸£à¸°à¸Šà¸²à¸Šà¸™
- `findByPhone(phone)` - à¸„à¹‰à¸™à¸«à¸²à¸”à¹‰à¸§à¸¢à¹€à¸šà¸­à¸£à¹Œà¹‚à¸—à¸£
- `findAll(options)` - à¸”à¸¶à¸‡à¸£à¸²à¸¢à¸à¸²à¸£à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸” (à¸à¸£à¹‰à¸­à¸¡ pagination, search)
- `count(search)` - à¸™à¸±à¸šà¸ˆà¸³à¸™à¸§à¸™
- `update(patientId, updateData)` - à¸­à¸±à¸›à¹€à¸”à¸•à¸‚à¹‰à¸­à¸¡à¸¹à¸¥
- `delete(patientId)` - à¸¥à¸šà¸œà¸¹à¹‰à¸›à¹ˆà¸§à¸¢
- `findByIdWithUser(patientId)` - à¸”à¸¶à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸à¸£à¹‰à¸­à¸¡ user

**Business Rules:**
- âœ“ à¹€à¸¥à¸‚à¸šà¸±à¸•à¸£à¸›à¸£à¸°à¸Šà¸²à¸Šà¸™à¸•à¹‰à¸­à¸‡à¹„à¸¡à¹ˆà¸‹à¹‰à¸³
- âœ“ à¹€à¸šà¸­à¸£à¹Œà¹‚à¸—à¸£à¸•à¹‰à¸­à¸‡à¹„à¸¡à¹ˆà¸‹à¹‰à¸³
- âœ“ à¸•à¹‰à¸­à¸‡à¸¡à¸µà¸Šà¸·à¹ˆà¸­, à¸™à¸²à¸¡à¸ªà¸à¸¸à¸¥, à¹€à¸šà¸­à¸£à¹Œà¹‚à¸—à¸£
- âœ“ à¹„à¸¡à¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¸¥à¸šà¸œà¸¹à¹‰à¸›à¹ˆà¸§à¸¢à¸—à¸µà¹ˆà¸¡à¸µà¸›à¸£à¸°à¸§à¸±à¸•à¸´à¸à¸²à¸£à¸™à¸±à¸”à¸«à¸¡à¸²à¸¢à¹„à¸”à¹‰

### 2. Dentist.model.js

à¸ˆà¸±à¸”à¸à¸²à¸£à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸—à¸±à¸™à¸•à¹à¸à¸—à¸¢à¹Œ

**Methods:**
- `create(dentistData)` - à¸ªà¸£à¹‰à¸²à¸‡à¸—à¸±à¸™à¸•à¹à¸à¸—à¸¢à¹Œà¹ƒà¸«à¸¡à¹ˆ
- `findById(dentistId)` - à¸„à¹‰à¸™à¸«à¸²à¸”à¹‰à¸§à¸¢ ID
- `findByUserId(userId)` - à¸„à¹‰à¸™à¸«à¸²à¸”à¹‰à¸§à¸¢ user_id
- `findByLicenseNumber(licenseNumber)` - à¸„à¹‰à¸™à¸«à¸²à¸”à¹‰à¸§à¸¢à¹€à¸¥à¸‚à¹ƒà¸šà¸­à¸™à¸¸à¸à¸²à¸•
- `findAll(options)` - à¸”à¸¶à¸‡à¸£à¸²à¸¢à¸à¸²à¸£à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”
- `count(search)` - à¸™à¸±à¸šà¸ˆà¸³à¸™à¸§à¸™
- `update(dentistId, updateData)` - à¸­à¸±à¸›à¹€à¸”à¸•à¸‚à¹‰à¸­à¸¡à¸¹à¸¥
- `delete(dentistId)` - à¸¥à¸šà¸—à¸±à¸™à¸•à¹à¸à¸—à¸¢à¹Œ
- `findByIdWithUser(dentistId)` - à¸”à¸¶à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸à¸£à¹‰à¸­à¸¡ user
- `getStatistics(dentistId)` - à¸”à¸¶à¸‡à¸ªà¸–à¸´à¸•à¸´

**Business Rules:**
- âœ“ à¹€à¸¥à¸‚à¹ƒà¸šà¸­à¸™à¸¸à¸à¸²à¸•à¸•à¹‰à¸­à¸‡à¹„à¸¡à¹ˆà¸‹à¹‰à¸³
- âœ“ à¹à¸•à¹ˆà¸¥à¸° user_id à¸¡à¸µà¹‚à¸›à¸£à¹„à¸Ÿà¸¥à¹Œà¸—à¸±à¸™à¸•à¹à¸à¸—à¸¢à¹Œà¹„à¸”à¹‰à¹à¸„à¹ˆ 1 à¹‚à¸›à¸£à¹„à¸Ÿà¸¥à¹Œ
- âœ“ à¸•à¹‰à¸­à¸‡à¸¡à¸µà¸Šà¸·à¹ˆà¸­, à¸™à¸²à¸¡à¸ªà¸à¸¸à¸¥
- âœ“ à¹„à¸¡à¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¸¥à¸šà¸—à¸±à¸™à¸•à¹à¸à¸—à¸¢à¹Œà¸—à¸µà¹ˆà¸¡à¸µà¸›à¸£à¸°à¸§à¸±à¸•à¸´à¸à¸²à¸£à¸™à¸±à¸”à¸«à¸¡à¸²à¸¢à¹„à¸”à¹‰

### 3. User.model.js

à¸ˆà¸±à¸”à¸à¸²à¸£à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸œà¸¹à¹‰à¹ƒà¸Šà¹‰à¸£à¸°à¸šà¸šà¹à¸¥à¸° authentication

**Methods:**
- `create(userData)` - à¸ªà¸£à¹‰à¸²à¸‡ user à¹ƒà¸«à¸¡à¹ˆ
- `findById(userId)` - à¸„à¹‰à¸™à¸«à¸²à¸”à¹‰à¸§à¸¢ ID
- `findByEmail(email)` - à¸„à¹‰à¸™à¸«à¸²à¸”à¹‰à¸§à¸¢à¸­à¸µà¹€à¸¡à¸¥
- `findByUsername(username)` - à¸„à¹‰à¸™à¸«à¸²à¸”à¹‰à¸§à¸¢ username
- `authenticate(email, password)` - à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸à¸²à¸£ login
- `changePassword(userId, currentPassword, newPassword)` - à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¸£à¸«à¸±à¸ªà¸œà¹ˆà¸²à¸™
- `resetPassword(userId, newPassword)` - à¸£à¸µà¹€à¸‹à¹‡à¸•à¸£à¸«à¸±à¸ªà¸œà¹ˆà¸²à¸™
- `update(userId, updateData)` - à¸­à¸±à¸›à¹€à¸”à¸•à¸‚à¹‰à¸­à¸¡à¸¹à¸¥
- `delete(userId)` - à¸¥à¸š user
- `findByRole(role, options)` - à¸„à¹‰à¸™à¸«à¸²à¸•à¸²à¸¡ role
- `count(role)` - à¸™à¸±à¸šà¸ˆà¸³à¸™à¸§à¸™

**Business Rules:**
- âœ“ à¸­à¸µà¹€à¸¡à¸¥à¸•à¹‰à¸­à¸‡à¹„à¸¡à¹ˆà¸‹à¹‰à¸³à¹à¸¥à¸°à¸•à¹‰à¸­à¸‡à¹€à¸›à¹‡à¸™à¸£à¸¹à¸›à¹à¸šà¸šà¸—à¸µà¹ˆà¸–à¸¹à¸à¸•à¹‰à¸­à¸‡
- âœ“ Username à¸•à¹‰à¸­à¸‡à¹„à¸¡à¹ˆà¸‹à¹‰à¸³ (à¸–à¹‰à¸²à¸¡à¸µ)
- âœ“ à¸£à¸«à¸±à¸ªà¸œà¹ˆà¸²à¸™à¸•à¹‰à¸­à¸‡à¸¡à¸µà¸­à¸¢à¹ˆà¸²à¸‡à¸™à¹‰à¸­à¸¢ 6 à¸•à¸±à¸§à¸­à¸±à¸à¸©à¸£
- âœ“ à¸£à¸«à¸±à¸ªà¸œà¹ˆà¸²à¸™à¸–à¸¹à¸ hash à¸”à¹‰à¸§à¸¢ bcrypt
- âœ“ Role à¸•à¹‰à¸­à¸‡à¹€à¸›à¹‡à¸™ 1 (admin), 2 (dentist), à¸«à¸£à¸·à¸­ 3 (patient)
- âœ“ à¹„à¸¡à¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¸¥à¸š user à¸—à¸µà¹ˆà¸¡à¸µà¹‚à¸›à¸£à¹„à¸Ÿà¸¥à¹Œà¸œà¸¹à¸à¸­à¸¢à¸¹à¹ˆà¹„à¸”à¹‰

### 4. Queue.model.js

à¸ˆà¸±à¸”à¸à¸²à¸£à¸„à¸´à¸§à¸™à¸±à¸”à¸«à¸¡à¸²à¸¢

**Methods:**
- `create(queueData)` - à¸ªà¸£à¹‰à¸²à¸‡à¸„à¸´à¸§à¸™à¸±à¸”à¸«à¸¡à¸²à¸¢à¹ƒà¸«à¸¡à¹ˆ
- `checkDentistConflict(dentistId, appointmentTime, treatmentId, excludeQueueId)` - à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸„à¸§à¸²à¸¡à¸‚à¸±à¸”à¹à¸¢à¹‰à¸‡à¹€à¸§à¸¥à¸²
- `findByIdWithDetails(queueId)` - à¸„à¹‰à¸™à¸«à¸²à¸à¸£à¹‰à¸­à¸¡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”
- `findById(queueId)` - à¸„à¹‰à¸™à¸«à¸²à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸à¸·à¹‰à¸™à¸à¸²à¸™
- `findByPatientId(patientId, options)` - à¸”à¸¶à¸‡à¸„à¸´à¸§à¸‚à¸­à¸‡à¸œà¸¹à¹‰à¸›à¹ˆà¸§à¸¢
- `findByDentistId(dentistId, options)` - à¸”à¸¶à¸‡à¸„à¸´à¸§à¸‚à¸­à¸‡à¸—à¸±à¸™à¸•à¹à¸à¸—à¸¢à¹Œ
- `findAll(options)` - à¸”à¸¶à¸‡à¸„à¸´à¸§à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸” (admin)
- `updateStatus(queueId, status)` - à¸­à¸±à¸›à¹€à¸”à¸•à¸ªà¸–à¸²à¸™à¸°
- `cancel(queueId)` - à¸¢à¸à¹€à¸¥à¸´à¸à¸„à¸´à¸§
- `count(filters)` - à¸™à¸±à¸šà¸ˆà¸³à¸™à¸§à¸™
- `delete(queueId)` - à¸¥à¸šà¸„à¸´à¸§

**Business Rules:**
- âœ“ à¸•à¹‰à¸­à¸‡à¸¡à¸µà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸„à¸£à¸š (queuedetailId, patientId, treatmentId, dentistId, time)
- âœ“ à¸—à¸±à¸™à¸•à¹à¸à¸—à¸¢à¹Œà¹„à¸¡à¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¸¡à¸µà¸™à¸±à¸”à¸«à¸¡à¸²à¸¢à¸‹à¹‰à¸­à¸™à¸—à¸±à¸šà¸à¸±à¸™à¹„à¸”à¹‰
- âœ“ à¸„à¸³à¸™à¸§à¸“à¹€à¸§à¸¥à¸²à¸ªà¸´à¹‰à¸™à¸ªà¸¸à¸”à¸•à¸²à¸¡ duration à¸‚à¸­à¸‡à¸à¸²à¸£à¸£à¸±à¸à¸©à¸²
- âœ“ à¸ªà¸–à¸²à¸™à¸°à¸•à¹‰à¸­à¸‡à¹€à¸›à¹‡à¸™: pending, confirmed, completed, cancelled
- âœ“ à¹„à¸¡à¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¸¢à¸à¹€à¸¥à¸´à¸à¸„à¸´à¸§à¸—à¸µà¹ˆà¹€à¸ªà¸£à¹‡à¸ˆà¸ªà¸´à¹‰à¸™à¹à¸¥à¹‰à¸§

### 5. Treatment.model.js

à¸ˆà¸±à¸”à¸à¸²à¸£à¸›à¸£à¸°à¹€à¸ à¸—à¸à¸²à¸£à¸£à¸±à¸à¸©à¸²

**Methods:**
- `create(treatmentData)` - à¸ªà¸£à¹‰à¸²à¸‡à¸à¸²à¸£à¸£à¸±à¸à¸©à¸²à¹ƒà¸«à¸¡à¹ˆ
- `findById(treatmentId)` - à¸„à¹‰à¸™à¸«à¸²à¸”à¹‰à¸§à¸¢ ID
- `findByName(treatmentName)` - à¸„à¹‰à¸™à¸«à¸²à¸”à¹‰à¸§à¸¢à¸Šà¸·à¹ˆà¸­
- `findAll(options)` - à¸”à¸¶à¸‡à¸£à¸²à¸¢à¸à¸²à¸£à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”
- `findAllActive()` - à¸”à¸¶à¸‡à¸£à¸²à¸¢à¸à¸²à¸£à¸—à¸µà¹ˆ active
- `count(search)` - à¸™à¸±à¸šà¸ˆà¸³à¸™à¸§à¸™
- `update(treatmentId, updateData)` - à¸­à¸±à¸›à¹€à¸”à¸•à¸‚à¹‰à¸­à¸¡à¸¹à¸¥
- `delete(treatmentId)` - à¸¥à¸šà¸à¸²à¸£à¸£à¸±à¸à¸©à¸²
- `getUsageStatistics(treatmentId)` - à¸”à¸¶à¸‡à¸ªà¸–à¸´à¸•à¸´à¸à¸²à¸£à¹ƒà¸Šà¹‰à¸‡à¸²à¸™
- `findPopular(limit)` - à¸”à¸¶à¸‡à¸à¸²à¸£à¸£à¸±à¸à¸©à¸²à¸—à¸µà¹ˆà¹„à¸”à¹‰à¸£à¸±à¸šà¸„à¸§à¸²à¸¡à¸™à¸´à¸¢à¸¡

**Business Rules:**
- âœ“ à¸Šà¸·à¹ˆà¸­à¸à¸²à¸£à¸£à¸±à¸à¸©à¸²à¸•à¹‰à¸­à¸‡à¹„à¸¡à¹ˆà¸‹à¹‰à¸³
- âœ“ à¸•à¹‰à¸­à¸‡à¸¡à¸µà¸Šà¸·à¹ˆà¸­à¹à¸¥à¸°à¸£à¸°à¸¢à¸°à¹€à¸§à¸¥à¸²
- âœ“ à¸£à¸°à¸¢à¸°à¹€à¸§à¸¥à¸²à¸•à¹‰à¸­à¸‡à¸¡à¸²à¸à¸à¸§à¹ˆà¸² 0 à¸™à¸²à¸—à¸µ
- âœ“ à¸£à¸²à¸„à¸²à¸•à¹‰à¸­à¸‡à¹„à¸¡à¹ˆà¸•à¸´à¸”à¸¥à¸š
- âœ“ à¹„à¸¡à¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¸¥à¸šà¸à¸²à¸£à¸£à¸±à¸à¸©à¸²à¸—à¸µà¹ˆà¸¡à¸µà¸à¸²à¸£à¹ƒà¸Šà¹‰à¸‡à¸²à¸™à¹ƒà¸™à¸™à¸±à¸”à¸«à¸¡à¸²à¸¢à¹„à¸”à¹‰

### 6. TreatmentHistory.model.js

à¸ˆà¸±à¸”à¸à¸²à¸£à¸›à¸£à¸°à¸§à¸±à¸•à¸´à¸à¸²à¸£à¸£à¸±à¸à¸©à¸²

**Methods:**
- `create(historyData)` - à¸ªà¸£à¹‰à¸²à¸‡à¸›à¸£à¸°à¸§à¸±à¸•à¸´à¸à¸²à¸£à¸£à¸±à¸à¸©à¸²à¹ƒà¸«à¸¡à¹ˆ
- `findById(historyId)` - à¸„à¹‰à¸™à¸«à¸²à¸”à¹‰à¸§à¸¢ ID
- `findByQueueDetailId(queuedetailId)` - à¸„à¹‰à¸™à¸«à¸²à¸”à¹‰à¸§à¸¢ queuedetail_id
- `findByQueueIdWithDetails(queueId)` - à¸„à¹‰à¸™à¸«à¸²à¸à¸£à¹‰à¸­à¸¡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”
- `findByPatientId(patientId, options)` - à¸”à¸¶à¸‡à¸›à¸£à¸°à¸§à¸±à¸•à¸´à¸‚à¸­à¸‡à¸œà¸¹à¹‰à¸›à¹ˆà¸§à¸¢
- `findByDentistId(dentistId, options)` - à¸”à¸¶à¸‡à¸›à¸£à¸°à¸§à¸±à¸•à¸´à¸‚à¸­à¸‡à¸—à¸±à¸™à¸•à¹à¸à¸—à¸¢à¹Œ
- `update(queuedetailId, updateData)` - à¸­à¸±à¸›à¹€à¸”à¸•à¸›à¸£à¸°à¸§à¸±à¸•à¸´
- `createOrUpdate(historyData)` - à¸ªà¸£à¹‰à¸²à¸‡à¸«à¸£à¸·à¸­à¸­à¸±à¸›à¹€à¸”à¸•
- `delete(historyId)` - à¸¥à¸šà¸›à¸£à¸°à¸§à¸±à¸•à¸´
- `deleteByQueueDetailId(queuedetailId)` - à¸¥à¸šà¸”à¹‰à¸§à¸¢ queuedetail_id
- `count(filters)` - à¸™à¸±à¸šà¸ˆà¸³à¸™à¸§à¸™
- `getStatistics(filters)` - à¸”à¸¶à¸‡à¸ªà¸–à¸´à¸•à¸´

**Business Rules:**
- âœ“ à¸•à¹‰à¸­à¸‡à¸¡à¸µ queuedetailId à¹à¸¥à¸° diagnosis
- âœ“ diagnosis à¸•à¹‰à¸­à¸‡à¸¡à¸µà¸­à¸¢à¹ˆà¸²à¸‡à¸™à¹‰à¸­à¸¢ 20 à¸•à¸±à¸§à¸­à¸±à¸à¸©à¸£
- âœ“ à¹à¸•à¹ˆà¸¥à¸° queuedetail_id à¸¡à¸µà¸›à¸£à¸°à¸§à¸±à¸•à¸´à¸à¸²à¸£à¸£à¸±à¸à¸©à¸²à¹„à¸”à¹‰à¹à¸„à¹ˆ 1 à¸£à¸²à¸¢à¸à¸²à¸£
- âœ“ `createOrUpdate()` à¸ˆà¸°à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¹à¸¥à¸°à¹€à¸¥à¸·à¸­à¸à¸—à¸³ create à¸«à¸£à¸·à¸­ update à¸­à¸±à¸•à¹‚à¸™à¸¡à¸±à¸•à¸´

## ğŸ”„ à¸§à¸´à¸˜à¸µà¹ƒà¸Šà¹‰à¸‡à¸²à¸™ Models

### à¸•à¸±à¸§à¸­à¸¢à¹ˆà¸²à¸‡à¸—à¸µà¹ˆ 1: à¸ªà¸£à¹‰à¸²à¸‡à¸œà¸¹à¹‰à¸›à¹ˆà¸§à¸¢à¹ƒà¸«à¸¡à¹ˆ (Controller)

```javascript
const { PatientModel } = require('../models');

// âŒ à¹à¸šà¸šà¹€à¸”à¸´à¸¡ (SQL à¹ƒà¸™ Controller)
exports.createPatient = async (req, res) => {
  try {
    const { fname, lname, phone, id_card } = req.body;

    // SQL à¸¢à¸²à¸§à¹€à¸¢à¸­à¸° validation à¹€à¸¢à¸­à¸°à¹ƒà¸™ controller
    const [existing] = await db.execute('SELECT * FROM patient WHERE id_card = ?', [id_card]);
    if (existing.length > 0) {
      return res.status(400).json({ error: 'ID card exists' });
    }

    const [result] = await db.execute(
      'INSERT INTO patient (fname, lname, phone, id_card) VALUES (?, ?, ?, ?)',
      [fname, lname, phone, id_card]
    );

    res.json({ success: true, patientId: result.insertId });
  } catch (error) {
    res.status(500).json({ error: error.message });
  }
};

// âœ… à¹à¸šà¸šà¹ƒà¸«à¸¡à¹ˆ (à¹ƒà¸Šà¹‰ Model)
exports.createPatient = async (req, res) => {
  try {
    const result = await PatientModel.create(req.body);
    res.json(result);
  } catch (error) {
    // Model à¸ˆà¸° throw error à¸à¸£à¹‰à¸­à¸¡ message à¸—à¸µà¹ˆà¸Šà¸±à¸”à¹€à¸ˆà¸™
    res.status(400).json({ error: error.message });
  }
};
```

### à¸•à¸±à¸§à¸­à¸¢à¹ˆà¸²à¸‡à¸—à¸µà¹ˆ 2: à¸”à¸¶à¸‡à¸£à¸²à¸¢à¸à¸²à¸£à¸„à¸´à¸§à¸™à¸±à¸”à¸«à¸¡à¸²à¸¢

```javascript
const { QueueModel } = require('../models');

// âœ… à¹ƒà¸™ Controller
exports.getDentistAppointments = async (req, res) => {
  try {
    const dentistId = req.dentist.dentist_id;
    const { date, status } = req.query;

    // Model à¸ˆà¸±à¸”à¸à¸²à¸£ SQL à¹à¸¥à¸° business logic
    const appointments = await QueueModel.findByDentistId(dentistId, {
      date,
      status,
      limit: 50,
      offset: 0
    });

    res.json({ success: true, appointments });
  } catch (error) {
    res.status(500).json({ error: error.message });
  }
};
```

### à¸•à¸±à¸§à¸­à¸¢à¹ˆà¸²à¸‡à¸—à¸µà¹ˆ 3: Authentication

```javascript
const { UserModel } = require('../models');

// âœ… à¹ƒà¸™ Controller
exports.login = async (req, res) => {
  try {
    const { email, password } = req.body;

    // Model à¸ˆà¸±à¸”à¸à¸²à¸£ authentication logic
    const result = await UserModel.authenticate(email, password);

    if (!result.success) {
      return res.status(401).json({ error: result.message });
    }

    // à¹€à¸à¹‡à¸š session
    req.session.user = result.user;
    res.json({ success: true, user: result.user });
  } catch (error) {
    res.status(500).json({ error: error.message });
  }
};
```

## ğŸ¨ Architecture Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         CLIENT                              â”‚
â”‚                    (Browser / Mobile)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚ HTTP Request
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ROUTES                              â”‚
â”‚              (Routing, Middleware, Auth)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      CONTROLLERS                            â”‚
â”‚  â€¢ à¸£à¸±à¸š HTTP request                                         â”‚
â”‚  â€¢ à¹€à¸£à¸µà¸¢à¸à¹ƒà¸Šà¹‰ Models                                          â”‚
â”‚  â€¢ à¸ˆà¸±à¸”à¸à¸²à¸£ response (status code, JSON)                     â”‚
â”‚  â€¢ à¸ˆà¸±à¸”à¸à¸²à¸£ session                                           â”‚
â”‚  â€¢ Render views                                             â”‚
â”‚  âŒ à¹„à¸¡à¹ˆà¸¡à¸µ SQL                                              â”‚
â”‚  âŒ à¹„à¸¡à¹ˆà¸¡à¸µ business logic à¹€à¸Šà¸´à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚ à¹€à¸£à¸µà¸¢à¸à¹ƒà¸Šà¹‰
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         MODELS                              â”‚
â”‚  â€¢ CRUD operations                                          â”‚
â”‚  â€¢ SQL queries, JOINs, transactions                         â”‚
â”‚  â€¢ Data validation                                          â”‚
â”‚  â€¢ Business logic à¹€à¸Šà¸´à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥                               â”‚
â”‚  â€¢ Domain rules                                             â”‚
â”‚  âœ… throw Error à¹€à¸¡à¸·à¹ˆà¸­à¸¡à¸µà¸›à¸±à¸à¸«à¸²                                â”‚
â”‚  âœ… return à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸—à¸µà¹ˆà¸ªà¸°à¸­à¸²à¸”à¸à¸£à¹‰à¸­à¸¡à¹ƒà¸Šà¹‰                           â”‚
â”‚  âŒ à¹„à¸¡à¹ˆà¸£à¸¹à¹‰à¸ˆà¸±à¸ HTTP / status code                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚ Query
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       DATABASE                              â”‚
â”‚                        (MySQL)                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“Š Error Handling Pattern

Models à¹ƒà¸Šà¹‰ **throw Error** à¹€à¸¡à¸·à¹ˆà¸­à¹€à¸ˆà¸­à¸›à¸±à¸à¸«à¸² Controllers à¸ˆà¸±à¸š error à¹à¸¥à¸°à¹à¸›à¸¥à¸‡à¹€à¸›à¹‡à¸™ HTTP response:

```javascript
// à¹ƒà¸™ Model
static async create(patientData) {
  // Validate
  if (!fname || !lname) {
    throw new Error('à¸à¸£à¸¸à¸“à¸²à¸à¸£à¸­à¸à¸Šà¸·à¹ˆà¸­à¹à¸¥à¸°à¸™à¸²à¸¡à¸ªà¸à¸¸à¸¥'); // âŒ à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹„à¸¡à¹ˆà¸„à¸£à¸š
  }

  // Check duplicate
  const existing = await this.findByIdCard(id_card);
  if (existing) {
    throw new Error('à¹€à¸¥à¸‚à¸šà¸±à¸•à¸£à¸›à¸£à¸°à¸Šà¸²à¸Šà¸™à¸™à¸µà¹‰à¸¡à¸µà¹ƒà¸™à¸£à¸°à¸šà¸šà¹à¸¥à¹‰à¸§'); // âŒ à¸‹à¹‰à¸³
  }

  // Success
  return { patientId: 123, success: true }; // âœ… à¸ªà¸³à¹€à¸£à¹‡à¸ˆ
}

// à¹ƒà¸™ Controller
try {
  const result = await PatientModel.create(req.body);
  res.status(201).json(result); // âœ… 201 Created
} catch (error) {
  res.status(400).json({ error: error.message }); // âŒ 400 Bad Request
}
```

## âœ… Benefits

1. **Code Reusability** - à¹ƒà¸Šà¹‰ Model à¸‹à¹‰à¸³à¹„à¸”à¹‰à¹ƒà¸™à¸«à¸¥à¸²à¸¢ Controller
2. **Testability** - à¸—à¸”à¸ªà¸­à¸š Model à¹à¸¢à¸à¹„à¸”à¹‰à¹‚à¸”à¸¢à¹„à¸¡à¹ˆà¸•à¹‰à¸­à¸‡à¸ˆà¸³à¸¥à¸­à¸‡ HTTP
3. **Maintainability** - à¹à¸à¹‰à¹„à¸‚ logic à¸—à¸µà¹ˆ Model à¹„à¸”à¹‰à¸—à¸µà¹ˆà¹€à¸”à¸µà¸¢à¸§
4. **Separation of Concerns** - à¹à¸¢à¸à¸«à¸™à¹‰à¸²à¸—à¸µà¹ˆà¸Šà¸±à¸”à¹€à¸ˆà¸™
5. **Easy to Document** - à¹€à¸‚à¸µà¸¢à¸™ API docs à¸‡à¹ˆà¸²à¸¢
6. **Type Safety** - à¹€à¸à¸´à¹ˆà¸¡ TypeScript à¹„à¸”à¹‰à¸‡à¹ˆà¸²à¸¢
7. **Database Abstraction** - à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™ database à¹„à¸”à¹‰à¸‡à¹ˆà¸²à¸¢

## ğŸš€ Next Steps

1. âœ… à¸ªà¸£à¹‰à¸²à¸‡ Models à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸” (à¹€à¸ªà¸£à¹‡à¸ˆà¹à¸¥à¹‰à¸§)
2. â³ Refactor Controllers à¹ƒà¸«à¹‰à¹ƒà¸Šà¹‰ Models
3. â³ à¸¥à¸š SQL à¸­à¸­à¸à¸ˆà¸²à¸ Controllers
4. â³ à¹€à¸à¸´à¹ˆà¸¡ Unit Tests à¸ªà¸³à¸«à¸£à¸±à¸š Models
5. â³ à¹€à¸à¸´à¹ˆà¸¡ JSDoc comments
6. â³ à¸ªà¸£à¹‰à¸²à¸‡ UML Class Diagrams

## ğŸ“ Notes

- à¸—à¸¸à¸ Model method à¹€à¸›à¹‡à¸™ `static` à¹€à¸à¸£à¸²à¸°à¹„à¸¡à¹ˆà¸•à¹‰à¸­à¸‡à¸à¸²à¸£ instance
- à¹ƒà¸Šà¹‰ `async/await` à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”
- Error messages à¹€à¸›à¹‡à¸™à¸ à¸²à¸©à¸²à¹„à¸—à¸¢à¹€à¸à¸·à¹ˆà¸­à¹ƒà¸«à¹‰à¸œà¸¹à¹‰à¹ƒà¸Šà¹‰à¹€à¸‚à¹‰à¸²à¹ƒà¸ˆà¸‡à¹ˆà¸²à¸¢
- à¸—à¸¸à¸ Model à¸£à¸±à¸š options object à¸ªà¸³à¸«à¸£à¸±à¸š pagination à¹à¸¥à¸° filters
- Password à¸–à¸¹à¸ hash à¸”à¹‰à¸§à¸¢ bcrypt (salt rounds = 10)
- à¸—à¸¸à¸ Model à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸š business rules à¸à¹ˆà¸­à¸™ execute query
